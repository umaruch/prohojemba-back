## 1. Общее описание системы

Система позволяет пользователям отмечать весь контент, который они "употребили",
только планируют или он их не интересует.

## 2. Описание функциональных блоков
В системе планируются такие функциональные блоки:
* Регистрация, аутентификация и авторизация
* Обновление пользовательской информации
* Обновление статуса "употребления" контента
* Создание, редактирование и удаление тайтла
* Создание, редактирование и удаления типов тайтлов
* Обновление разрешений пользователя

### 2.1. Система разрешений
Планируется система доступа по разрешениям. У пользователя при успешной
регистрации будет доступ практически ко всему функционалу, кроме 
редактирования других пользователей и обновления разрешений.

### 2.2. Регистрация
Процесс регистрации состоит из нескольких этапов.

Пользователь отправляет форму со следующими полями:
- email - обязательное поле

Затем должны быть запрошены следующие поля:
- email - обязательное поле, должно быть уникальным
- username - обязательное поле, должно быть уникальным
- password - обязательное поле
- code - обязательное поле

Поле code содержит в себе одноразовый пароль, высылаемый на указанный email.

### 2.3. Аутентификация
Процесс аутентификации осуществляется по email и паролю.

### 2.4. Авторизация
В процессе авторизации участвуют access и refresh токены. Access токен отправляется в 
заголовках запроса и необходим для всех запросах. При устаревании токена запрос вернет
ошибку авторизации. Клиентское приложение должно обработать ошибку и отправить запрос с
обновлением пары токенов.

### 2.5. Редактирование аккаунта

#### 2.5.1. Смена username и других полей
Пользователь просто отправляет форму с непустым полем username, система
проверяет что содержимое уникально.

#### 2.5.2. Смена пароля
Пользователь отправляет форму со следующими полями:
- password - обязательное поле
- new_password - обязательное поле

Система проверяет что password совпадает с текущим паролем, если все нормально,
то записывается новый пароль и все текущие сессии удаляются.

#### 2.5.3. Смена email
Пользователь отправляет форму со следующими полями:
- email - обязательное поле

Где email это новая почта пользователя. На нее придет код для смены почты.

Затем отправляется форма с полями:
- email - обязательное поле
- code - обязательное поле
- password - обязательное поле

#### 2.5.4. Сброс пароля
Пользователь отправляет форму со следующими полями:
- email - обязательное поле

Ему приходит на указанную почту код для сброса пароля. Затем отправляется
форма с полями:
- password - обязательное поле
- code - обязательное поле

В случае если все нормально сохраняется новый пароль и все текущие сессии удаляются.

#### 2.5.5. Сброс пароля (Другой пользователь)
* Доступно только пользователю с соответствующими правами.

Пользователь отправляет форму со следующим полем:
- password

В случае если все нормально сохраняется новый пароль и все текущие сессии удаляются.

? Возможно следует отправлять уведомление на почту

#### 2.5.6. Редактирование прав
* Доступно только пользователю с соответствующими правами. 

Пользователь отправляет форму в котором перечислены все активные права.

? Возможно следует отправлять уведомление на почту

### 2.6. Статус "употребления" контента
Пользователь отправляет форму со следующими полями:
- state - обязательное поле

Где state может иметь следующие значения none, planned, active, complete.

Если поле содержит none то запись о статусе удаляется

### 2.7. Работа с тайтлами
*Создание и редактирование доступно только пользователю с соответствующими правами.

#### 2.7.1 Список тайтлов
При получении списка тайтлов необходимо указать тип, он не может быть пустым.
Тайтлы будут содержать в себе информацию о его статусе для пользователя

### 2.8. Работа с типами тайтлов
*Создание и редактирование доступно только пользователю с соответствующими правами.

В целом все стандартно

## 3. Стек технологий
* Java 19 и Spring Boot 3 - бэкенд сервер
* PostreSQL - хранение данных
* Redis - хранение refresh токенов и кодов регистрации
* Vue 3 - web клиент

## 4. Структура API
Путь запроса к API должен начинаться с:
/api/v1/...

Запрос на отправку кода верификации должен оканчиваться:
.../verify

Предположительные пути:

Безопасность:
* POST /auth/register - регистрация пользователя
* POST /auth/login - аутентификация
* POST /auth/token - обновление пары токенов
* POST /auth/restore(/verify) - восстановление доступа к аккаунту

Учетные данные пользователя:
* PATCH /users/@me
* POST /users/@me/password(/verify)
* POST /users/{user_id}/password(/verify) - смена пароля
* POST /users/@me/email(/verify) - смена почты
* GET|POST /users/{user_id}/permissions - редактирование прав пользователя

Типы тайтлов:
* GET /types - получение списка имеющихся типов
* POST /types - создание нового типа
* PATCH /types/{system_name} - редактирование типа
* DELETE /types/{system_name} - удаление типа

Тайтлы
* GET /titles - получение тайтлов
* POST /titles - создание новой записи о тайтле
* PATCH /titles/{title_id} - редактирование записи о тайтле
* DELETE /titles/{title_id} - удаление записи о тайтле
* POST /titles/{title_id}/state - создание или редактирование статуса

Список будет дополняться в ходе разработки...

## 5. Описание пользовательского интерфейса
Так как на текущий момент не планируется какого-либо обширного функционала,
то и на клиентской стороне все будет просто. Список тайтлов будет выглядеть
в виде карточек.

## 6. Возможно полезные ссылки
https://gist.github.com/zmts/802dc9c3510d79fd40f9dc38a12bccfc - JWT авторизация